# gsi v0.2.0: Capability Flag System & Config Scaffolding

*2026-02-12T20:43:19Z*

gsi v0.2.0 introduces a **capability flag system** that replaces the old `--skip-*` flags with a consistent `--<name>` / `--no-<name>` pattern for every scaffold step. It also adds **config management scaffolding** â€” generating a complete viper-based config system in scaffolded projects â€” and switches the version command to a **template-based generation** with ldflags build vars.

## The Capability System

Every toggleable scaffold step is now a **capability** with a consistent flag pair. The `--no-<name>` flags are hidden from help output to keep it clean, but fully functional.

```bash
go run . --help 2>&1 | head -30
```

```output
gsi scaffolds a new Go project with cobra, viper,
mkdocs-material documentation, an embedded web UI, mockery, editorconfig,
and optional React/shadcn/Tailwind frontend.

Each capability can be toggled with --<name> / --no-<name> flags.
Defaults: most capabilities ON, ui OFF.

Examples:
  gsi my-awesome-app
  gsi --author "Jane Doe jane@example.com" my-app
  gsi --module github.com/myorg/myapp --dry-run my-app
  gsi --no-bmad --no-git my-app
  gsi --no-docker --no-release my-app
  gsi --only-docs my-app
  gsi --ui my-app
  gsi .    # Initialize in current directory

Usage:
  gsi [project-name] [flags]
  gsi [command]

Available Commands:
  completion  Generate the autocompletion script for the specified shell
  help        Help about any command
  version     Print the version information

Flags:
  -a, --author string   Author name and email (default "Joe Scharf joe@joescharf.com")
      --bmad            BMAD method framework installation (default true)
      --config          Viper config management scaffolding (default true)
```

All 11 capabilities are visible in the flags. Let's see the full flag list:

```bash
go run . --help 2>&1 | grep -E '^\s+-'
```

```output
  -a, --author string   Author name and email (default "Joe Scharf joe@joescharf.com")
      --bmad            BMAD method framework installation (default true)
      --config          Viper config management scaffolding (default true)
      --docker          Dockerfile and .dockerignore (default true)
      --docs            mkdocs-material documentation scaffolding (default true)
  -d, --dry-run         Show what would be done without executing
      --editorconfig    EditorConfig file (default true)
      --git             Git initialization and initial commit (default true)
      --goreleaser      GoReleaser configuration (default true)
  -h, --help            help for gsi
      --makefile        Makefile with common targets (default true)
      --mockery         Mockery configuration (default true)
  -m, --module string   Go module path (default: github.com/joescharf/<project>)
      --only-docs       Only add docs scaffolding (skip everything else)
      --release         GitHub Actions release workflow (default true)
      --ui              React/shadcn/Tailwind UI in ui/ subdirectory
  -v, --verbose         Enable verbose output
```

## Dry-Run with Capabilities Disabled

Let's demonstrate disabling several capabilities with `--no-*` flags in dry-run mode:

```bash
go run . --dry-run --no-docker --no-release --no-mockery --no-editorconfig --no-config demo-app 2>&1
```

```output
[1;33mâš [0m [DRY-RUN] Would create directory: /Users/joescharf/app/gsi/demo-app

[0;34mâ„¹[0m Configuration:
  Project Name:  demo-app
  Project Dir:   /Users/joescharf/app/gsi/demo-app
  Module Path:   github.com/joescharf/demo-app
  Author:        Joe Scharf joe@joescharf.com
  [1;33mMode:          DRY-RUN[0m

[0;34mâ„¹[0m Capabilities:
  bmad:          ON
  config:        OFF
  docker:        OFF
  docs:          ON
  editorconfig:  OFF
  git:           ON
  goreleaser:    ON
  makefile:      ON
  mockery:       OFF
  release:       OFF
  ui:            OFF

[0;34mâ„¹[0m Validating environment...
[0;32mâœ“[0m Environment validation complete
[0;34mâ„¹[0m Checking existing state...
[0;32mâœ“[0m No existing project files found

[0;34mâ„¹[0m Starting project initialization...

[0;34mâ„¹[0m Installing BMAD method framework
[1;33mâš [0m [DRY-RUN] Would execute: bunx bmad-method@alpha install
[0;32mâœ“[0m cobra-cli is already installed
[0;34mâ„¹[0m Initializing Go module
[1;33mâš [0m [DRY-RUN] Would execute: go mod init github.com/joescharf/demo-app
[0;34mâ„¹[0m Creating Cobra CLI application structure
[1;33mâš [0m [DRY-RUN] Would execute: cobra-cli init --viper --author "Joe Scharf joe@joescharf.com" --config $HOME/.config/demo-app
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/cmd/version.go
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/cmd/serve.go
[0;34mâ„¹[0m Skipping config command scaffolding (--no-config)
[0;34mâ„¹[0m Skipping config package scaffolding (--no-config)
[0;34mâ„¹[0m Skipping config init scaffolding (--no-config)
[0;34mâ„¹[0m Skipping mockery config (--no-mockery)
[0;34mâ„¹[0m Skipping editorconfig (--no-editorconfig)
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/internal/ui/dist/index.html
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/internal/ui/embed.go
[0;34mâ„¹[0m Tidying Go dependencies
[1;33mâš [0m [DRY-RUN] Would execute: go mod tidy
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/Makefile
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/.goreleaser.yml
[0;34mâ„¹[0m Skipping Dockerfile (--no-docker)
[0;34mâ„¹[0m Skipping .dockerignore (--no-docker)
[0;34mâ„¹[0m Skipping release workflow (--no-release)
[0;34mâ„¹[0m Initializing uv project in docs/
[1;33mâš [0m [DRY-RUN] Would execute: uv init --name demo-app-docs docs
[1;33mâš [0m [DRY-RUN] Would remove uv init scaffolding (docs/.git, docs/hello.py, docs/main.py, docs/README.md)
[0;34mâ„¹[0m Adding mkdocs-material dependencies
[1;33mâš [0m [DRY-RUN] Would execute: cd docs && uv add mkdocs-material 'mkdocs-git-revision-date-localized-plugin>=1.4' && cd ..
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/docs/mkdocs.yml
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/docs/.gitignore
[1;33mâš [0m [DRY-RUN] Would create docs/docs/stylesheets/
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/docs/docs/index.md
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/docs/docs/getting-started.md
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/docs/docs/stylesheets/extra.css
[0;34mâ„¹[0m Initializing git repository
[1;33mâš [0m [DRY-RUN] Would execute: git init
[1;33mâš [0m [DRY-RUN] Would create /Users/joescharf/app/gsi/demo-app/.gitignore
[1;33mâš [0m [DRY-RUN] Would create initial commit

[0;32mâœ“[0m Project initialization complete!

[0;34mâ„¹[0m Next steps:
  1. Review the generated code in cmd/
  2. Update the project description in cmd/root.go
  3. Run 'make build' to build your application
  4. Run 'make run' or './bin/demo-app --help' to see available commands
  5. Run 'make serve' to start the embedded web UI server
  6. Run 'make docs-serve' to start the docs dev server
  7. Run 'make help' to see all available targets

```

Notice the **Capabilities** section showing which are ON/OFF, and the skip messages for disabled steps (config, mockery, editorconfig, docker, release).

## Config Scaffolding Architecture

The `config` capability generates three files that wire up a complete viper-based config system:

```bash
echo '--- cmd/config.go template (config init/edit/check subcommands) ---' && head -30 internal/templates/files/cmd_config.go.tmpl && echo && echo '--- internal/config/config.go template (SetDefaults, ConfigDir, InitViper) ---' && head -30 internal/templates/files/config_go.tmpl && echo && echo '--- cmd/config_init.go template (cobra.OnInitialize wiring) ---' && head -20 internal/templates/files/cmd_config_init.go.tmpl
```

```output
--- cmd/config.go template (config init/edit/check subcommands) ---
package cmd

import (
	"fmt"
	"os"
	"os/exec"

	"{{.GoModulePath}}/internal/config"
	"github.com/spf13/cobra"
	"github.com/spf13/viper"
)

var configCmd = &cobra.Command{
	Use:   "config",
	Short: "Manage application configuration",
}

var configInitCmd = &cobra.Command{
	Use:   "init",
	Short: "Create the config directory and default config file",
	RunE: func(cmd *cobra.Command, args []string) error {
		cfgDir := config.ConfigDir()

		if err := config.EnsureDir(cfgDir); err != nil {
			return fmt.Errorf("create config directory: %w", err)
		}
		fmt.Fprintln(os.Stderr, "Config directory:", cfgDir)

		cfgPath := config.DefaultConfigFile()


--- internal/config/config.go template (SetDefaults, ConfigDir, InitViper) ---
package config

import (
	"os"
	"path/filepath"
	"strings"

	"github.com/spf13/viper"
)

// appName is used for config directory and env prefix.
const appName = "{{.ProjectName}}"

// ConfigDir returns the application configuration directory.
// Uses os.UserConfigDir() for OS-appropriate paths:
//
//	Linux/BSD: $XDG_CONFIG_HOME/<app> or ~/.config/<app>
//	macOS:     ~/Library/Application Support/<app>
//	Windows:   %AppData%/<app>
func ConfigDir() string {
	base, err := os.UserConfigDir()
	if err != nil {
		home, _ := os.UserHomeDir()
		base = filepath.Join(home, ".config")
	}
	return filepath.Join(base, appName)
}

// DefaultConfigFile returns the default config file path.
func DefaultConfigFile() string {

--- cmd/config_init.go template (cobra.OnInitialize wiring) ---
package cmd

import (
	"{{.GoModulePath}}/internal/config"
	"github.com/spf13/cobra"
)

// cfgFile holds the --config flag value.
var cfgFile string

func init() {
	cobra.OnInitialize(initConfig)
	rootCmd.PersistentFlags().StringVar(&cfgFile, "config", "", "config file (default: "+config.DefaultConfigFile()+")")
}

func initConfig() {
	config.InitViper(cfgFile)
}
```

## Capability Guard Pattern

Every scaffold step checks its capability before executing. Here's the pattern from `internal/scaffold/steps.go`:

```bash
grep -A4 'func (s \*Scaffolder) stepGenerate' internal/scaffold/steps.go | head -30
```

```output
func (s *Scaffolder) stepGenerateVersionCmd() error {
	return WriteTemplateFile(
		filepath.Join(s.Config.ProjectDir, "cmd", "version.go"),
		"cmd_version.go.tmpl",
		s.templateData(),
--
func (s *Scaffolder) stepGenerateServeCmd() error {
	return WriteTemplateFile(
		filepath.Join(s.Config.ProjectDir, "cmd", "serve.go"),
		"cmd_serve.go.tmpl",
		s.templateData(),
--
func (s *Scaffolder) stepGenerateConfigCmd() error {
	if !s.Config.IsEnabled(CapConfig) {
		s.Logger.Info("Skipping config command scaffolding (--no-config)")
		return nil
	}
--
func (s *Scaffolder) stepGenerateConfigPkg() error {
	if !s.Config.IsEnabled(CapConfig) {
		s.Logger.Info("Skipping config package scaffolding (--no-config)")
		return nil
	}
--
func (s *Scaffolder) stepGenerateConfigInit() error {
	if !s.Config.IsEnabled(CapConfig) {
		s.Logger.Info("Skipping config init scaffolding (--no-config)")
		return nil
	}
--
```

The `IsEnabled` / `Disable` methods on `Config` and the `DefaultCapabilities()` function live in `internal/scaffold/config.go`:

```bash
grep -A3 'func.*IsEnabled\|func.*Disable\|func Default' internal/scaffold/config.go
```

```output
func DefaultCapabilities() map[string]bool {
	return map[string]bool{
		CapBmad:         true,
		CapConfig:       true,
--
func (c *Config) IsEnabled(name string) bool {
	enabled, ok := c.Capabilities[name]
	return ok && enabled
}
--
func (c *Config) Disable(name string) {
	c.Capabilities[name] = false
}
```

## Tests

All tests pass, including new capability guard tests for every step:

```bash
go test ./... 2>&1 | grep -E '^(ok|FAIL)' | sed 's/[0-9]*\.[0-9]*s/(cached)/'
```

```output
ok  	github.com/joescharf/gsi/internal/logger	(cached)
ok  	github.com/joescharf/gsi/internal/scaffold	(cached)
ok  	github.com/joescharf/gsi/internal/templates	(cached)
```

```bash
go test ./internal/scaffold/ -v 2>&1 | grep -c PASS
```

```output
44
```

**All 3 packages pass (44 tests in scaffold alone).** The new capability guard and config scaffold tests ensure every step respects its `--no-*` flag.

## Release

Tagged and pushed as `v0.2.0`:

```bash
git log --oneline -3 && echo && git tag -l 'v0.2.*' && echo && git diff --stat v0.1.2..v0.2.0
```

```output
bdc85c3 Add capability flag system, config scaffolding, and version template
43c4069 Switch to brews config, add release workflow scaffold, publish releases directly
350c599 Add HOMEBREW_TAP_GITHUB_TOKEN support for Homebrew tap publishing

v0.2.0

 README.md                                        |  42 +++-
 cmd/root.go                                      |  64 ++++--
 docs/docs/cli-reference.md                       |  45 +++-
 docs/docs/configuration.md                       |  83 ++++++-
 docs/docs/contributing.md                        |  63 +++++-
 docs/docs/getting-started.md                     |  36 ++-
 docs/docs/index.md                               |   3 +-
 docs/docs/scaffolded-output.md                   |  53 ++++-
 internal/scaffold/config.go                      |  48 +++-
 internal/scaffold/config_test.go                 |  79 +++++++
 internal/scaffold/environment.go                 |  32 ++-
 internal/scaffold/scaffold.go                    |  43 +++-
 internal/scaffold/steps.go                       | 110 ++++++++--
 internal/scaffold/steps_test.go                  | 267 ++++++++++++++++++++++-
 internal/templates/files/cmd_config.go.tmpl      |  94 ++++++++
 internal/templates/files/cmd_config_init.go.tmpl |  18 ++
 internal/templates/files/cmd_version.go.tmpl     |  26 +++
 internal/templates/files/config_go.tmpl          |  72 ++++++
 18 files changed, 1077 insertions(+), 101 deletions(-)
```

**18 files changed, +1,077 / -101 lines.** The release workflow on GitHub Actions should now be building binaries, Docker images, and Homebrew formula from this tag.
