# goreleaser release --clean --verbose
# goreleaser release --snapshot --clean --skip homebrew,docker

project_name: {{.ProjectName}}
version: 2

before:
  hooks:
    - go mod download

builds:
  - id: {{.ProjectName}}
    binary: {{.ProjectName}}
    dir: .
    main: main.go
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
      - arm64
    ldflags:
      - -X {{.GoModulePath}}/cmd.version={{"{{"}} .Version {{"}}"}}
      - -X {{.GoModulePath}}/cmd.commit={{"{{"}} .Commit {{"}}"}}
      - -X {{.GoModulePath}}/cmd.date={{"{{"}} .Date {{"}}"}}

  - id: {{.ProjectName}}-macos
    binary: {{.ProjectName}}
    dir: .
    main: main.go
    env:
      - CGO_ENABLED=0
    goos:
      - darwin
    goarch:
      - amd64
    ldflags:
      - -X {{.GoModulePath}}/cmd.version={{"{{"}} .Version {{"}}"}}
      - -X {{.GoModulePath}}/cmd.commit={{"{{"}} .Commit {{"}}"}}
      - -X {{.GoModulePath}}/cmd.date={{"{{"}} .Date {{"}}"}}

# MacOS Universal Binaries
universal_binaries:
  - id: {{.ProjectName}}-macos
    replace: true

archives:
  - id: {{.ProjectName}}-linux-archive
    ids:
      - {{.ProjectName}}

  - id: {{.ProjectName}}-archive
    ids:
      - {{.ProjectName}}-macos
    formats:
      - zip
    files:
      - none*

checksum:
  name_template: "checksums.txt"

release:
  github:
    owner: {{.GoModuleOwner}}
    name: {{.ProjectName}}
  ids:
    - {{.ProjectName}}-archive
    - {{.ProjectName}}-linux-archive
  draft: false

snapshot:
  version_template: "{{"{{"}} incpatch .Version {{"}}"}}-devel"

# Uncomment and configure for Homebrew distribution:
# brews:
#   - repository:
#       owner: {{.GoModuleOwner}}
#       name: homebrew-tap
#       token: "{{"{{"}} .Env.HOMEBREW_TAP_TOKEN {{"}}"}}"
#     directory: Formula
#     homepage: "https://github.com/{{.GoModuleOwner}}/{{.ProjectName}}"
#     description: "Description of {{.ProjectName}}"
#     install: |
#       bin.install "{{.ProjectName}}"
#     test: |
#       system "#\{bin}/{{.ProjectName}}", "version"

changelog:
  sort: asc
  groups:
    - title: Features
      regexp: "^.*feat[(\\w)]*:+.*$"
      order: 0
    - title: "Bug fixes"
      regexp: "^.*fix[(\\w)]*:+.*$"
      order: 1
    - title: Others
      order: 999
  filters:
    exclude:
      - "^docs:"
      - "^test:"

# Multi-platform Docker images
dockers_v2:
  - images:
      - "ghcr.io/{{.GoModuleOwner}}/{{.ProjectName}}"
    tags:
      - "v{{"{{"}} .Version {{"}}"}}"
      - "latest"
    labels:
      "org.opencontainers.image.title": "{{"{{"}} .ProjectName {{"}}"}}"
      "org.opencontainers.image.description": "{{"{{"}} .ProjectName {{"}}"}}"
      "org.opencontainers.image.url": "https://github.com/{{.GoModuleOwner}}/{{"{{"}} .ProjectName {{"}}"}}"
      "org.opencontainers.image.source": "https://github.com/{{.GoModuleOwner}}/{{"{{"}} .ProjectName {{"}}"}}"
      "org.opencontainers.image.version": "{{"{{"}} .Version {{"}}"}}"
      "org.opencontainers.image.revision": "{{"{{"}} .FullCommit {{"}}"}}"
